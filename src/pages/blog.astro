---
// Trang danh sách bài viết blog
import Layout from '../components/common/Layout.astro';
import BlogHeader from '../components/Blog/BlogHeader.astro';
import PostList from '../components/Blog/PostList.astro';
import { getCollection } from 'astro:content';

// Lấy tất cả bài viết từ content collection (kèm bộ lọc phòng vệ)
const allPosts = await getCollection('blog');
const posts = allPosts.filter((p) => {
  try {
    return (
      p && p.data &&
      typeof p.data.title === 'string' &&
      typeof p.data.description === 'string' &&
      typeof p.data.category === 'string' &&
      typeof p.data.readingTime === 'number' &&
      p.data.publishedAt
    );
  } catch (_) {
    return false;
  }
});

// Sắp xếp theo ngày xuất bản (mới nhất trước)
const sortedPosts = posts.sort((a, b) => 
  new Date(b.data.publishedAt).getTime() - new Date(a.data.publishedAt).getTime()
);

// Bỏ cơ chế filter theo category/tag: hiển thị toàn bộ bài viết

---

<Layout title="Bài viết - Phúc Lee" description="Tất cả bài viết về học tiếng Hàn và văn hóa Hàn Quốc">
  <div class="blog-page">
    <BlogHeader />
    <PostList posts={sortedPosts} showTitle={false} />
  </div>
</Layout>

<style>
  .blog-page {
    max-width: 1200px;
    margin: 0 auto;
    padding: var(--spacing-xl);
  }

  /* Responsive */
  @media (max-width: 768px) {
    .blog-page {
      padding: var(--spacing-lg);
    }
  }
</style>